<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>California's Covid-19 Timeline</title>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <style>

        button {
            /*position:relative;*/
            /*left:80px;*/
            /*top:20px;*/
            background-color:lightblue;
            height:30px;
            width:60px;
            text-anchor: middle;
            font-family: Calibri,sans-serif;
            font-size: 16px;
            display: inline-block;
            margin: auto;
        }

        div {
            text-align: center;
            margin: auto;
        }

        svg {
            display: block;
            margin: auto;
        }

        p  {
            text-align: center;
            font-family: Calibri,serif;
            font-size: 19px;
        }

        .chart_title {
            text-align: center;
            font-family: Calibri,serif;
            font-size: 19px;
        }

        .legend {
            text-align: center;
            font-family: Calibri,serif;
            font-size: 16px;
        }

        .tooltip {

            text-align: center;
            font-family: Calibri,serif;
            font-size: 20px;
            color: green;
        }


    </style>
</head>
<body onload="init()">
<h1>California's Covid-19 Timeline</h1>
<div id="buttons">
    <button type="button" id="phase1" onclick="move_slide(1)">Phase1</button>
    <button type="button" id="phase2" onclick="move_slide(2)">Phase2</button>
    <button type="button" id="phase3" onclick="move_slide(3)">Phase3</button>
    <button type="button" id="phase4" onclick="move_slide(4)">Phase4</button>
    <p>Click buttons to view of Covid-19 spreading in California</p>
    <p>Hover over bar charts to see detailed data</p>
</div>
<svg id="new_cases" width="1800" height="500">
</svg>

<svg id="new_cases_anno" width="1800" height="50">
</svg>

<svg id="new_deaths" width="1800" height="500">
</svg>

<svg id="new_deaths_anno" width="1800" height="50">
</svg>

<script>

    d3.select("h1").style("text-align", "center").style("font-family", "Calibri");
    d3.select("#buttons").append("text")

    const top_left_title = "California Daily New Cases";
    const top_right_title = "California Cumulative Confirmed Cases";
    const bottom_left_title = "California Daily New Deaths";
    const bottom_right_title = "California Cumulative Deaths";
    
    const case_phase1_annotation = "Phase 1: Jan25 to Mar17. Initial phase of Covid-19 spreading in California.";
    const case_phase1_annotation_2 = "First confirmed case is confirmed on Jan25. Number of confirmed cases is increased steadily.";

    const case_phase2_annotation = "Phase 2: Mar17 to May8. Shelter-in-place phase in California";
    const case_phase2_annotation_2 = 'Shelter-in-place is issued on Mar17. Daily new cases jump back after economy re-open starts on end of Apr.';

    const case_phase3_annotation = "Phase 3: May8 to Jun18. Initial stage of economy reopening.";
    const case_phase3_annotation_2 = "Economy reopening causes residents flooding to hotspots. Daily new case count starts to jump rapidly.";

    const case_phase4_annotation = "Phase 4: Jun18 to Jul30. Rapid increasing stage";
    const case_phase4_annotation_2 = "Mandatory mask wearing is issued on Jun18. But due to the widely spreading, CA daily new cases surpasses NY by mid of Jul.";

    const death_phase1_annotation = "Phase 1: Jan25 to Mar17. Initial phase of Covid-19 spreading in California.";
    const death_phase1_annotation_2 = "First death is confirmed on Feb6. Number of deaths is increased steadily.";

    const death_phase2_annotation = "Phase 2: Mar17 to May8. Shelter-in-place phase in California";
    const death_phase2_annotation_2 = "Daily new death start to slow down by end of Apr.";

    const death_phase3_annotation = "Phase 3: May8 to Jun18. Initial stage of economy reopening.";
    const death_phase3_annotation_2 = "More lower age group residents are infected comparing to previous stage. Daily new death count is decreasing.";

    const death_phase4_annotation = "Phase 4: Jun18 to Jul30. Rapid increasing stage";
    const death_phase4_annotation_2 = "As daily confirmed cases increase exponentially, daily new deaths increase back to pre-lockdonw number by Jul. ";


    var width_total = 1800;
    var height_total = 500;
    var width_left = 800;
    var delta = width_total/2-width_left
    var height_left = 500;
    var width_right = width_left;
    var height_right = 500;
    var padding = 80;
    var padding_bottom = 20;
    var anno_padding_x = 50;
    var anno_padding_y = 20;
    var legend_padding_x = 20;
    var legend_padding_y = 0;

    // get date format for the 1st day of each month

    var case_phase1 = d3.timeParse("%m/%d/%Y")("3/19/2020"); //shelter-in-place
    var case_phase2 = d3.timeParse("%m/%d/%Y")("5/8/2020"); //re-opening
    var case_phase3 = d3.timeParse("%m/%d/%Y")("6/18/2020"); //mask mandate


    var death_phase1 = d3.timeParse("%m/%d/%Y")("3/19/2020");
    var death_phase2 = d3.timeParse("%m/%d/%Y")("5/8/2020");
    var death_phase3 = d3.timeParse("%m/%d/%Y")("6/18/2020");

    var case_phase1_data = [];
    var case_phase2_data = [];
    var case_phase3_data = [];
    var case_phase4_data = [];
    var death_phase1_data = [];
    var death_phase2_data = [];
    var death_phase3_data = [];
    var death_phase4_data = [];
    var covid_data = [];
    
    async function init() {

        const data =  await d3.csv("California_Covid_Source_Data.csv");

        // var parseDate = d3.timeFormat("%m/%d/%Y").parse; //parse the date

        // function read_data(data) {
            // var d = [];
            data.forEach(function (entry) {
                var current_date = d3.timeParse("%m/%d/%Y")(entry.date);
                var current_data ={date : d3.timeParse("%m/%d/%Y")(entry.date),
                    Cases: +entry.Cases,
                    New_Known_Cases: +entry.New_Known_Cases,
                    Seven_day_average_New_Cases: +entry.Seven_day_average_New_Cases,
                    Deaths: +entry.Deaths,
                    New_deaths: +entry.New_deaths,
                    Seven_day_average_New_deaths: +entry.Seven_day_average_New_deaths
                };
                covid_data.push(current_data);
                if (current_date <= case_phase1) {
                    case_phase1_data.push(current_data);
                }
                if (current_date <= case_phase2 && current_date >= case_phase1) {
                    case_phase2_data.push(current_data);
                }
                if (current_date <= case_phase3 && current_date >= case_phase2) {
                    case_phase3_data.push(current_data);
                }
                if (current_date >= case_phase3) {
                    case_phase4_data.push(current_data);
                }
                if (current_date <= death_phase1) {
                    death_phase1_data.push(current_data);
                }
                if (current_date <= death_phase2 && current_date >= death_phase1) {
                    death_phase2_data.push(current_data);
                }
                if (current_date <= death_phase3 && current_date >= death_phase2) {
                    death_phase3_data.push(current_data);
                }
                if (current_date >= death_phase3){
                    death_phase4_data.push(current_data);
                }
                
            })
            // return d;
        // }

        // var covid_data = read_data(data);

        // console.table(covid_data.slice(0,10));
        
        
        
        // scale for all the dates in the datalog

        var x_scale_left = d3.scaleTime()
            // .domain(d3.min(covid_data, function(d) { return d.date; }), d3.max(covid_data, function(d) { return d.date; }))
            .domain(d3.extent(covid_data, function (d) {return d.date ;}))
            .range([0, width_left-2*padding]);
        // .tickValues(['a','b']).render();
        // scale for the new known cases bar chart

        var x_scale_right = d3.scaleTime()
            // .domain(d3.min(covid_data, function(d) { return d.date; }), d3.max(covid_data, function(d) { return d.date; }))
            .domain(d3.extent(covid_data, function (d) {return d.date ;}))
            .range([0, width_right-2*padding]);
        // scale for the new known cases bar chart

        var y_scale_left_top = d3.scaleLinear()
            .domain([0, d3.max(covid_data, function (d) {
                return d.New_Known_Cases;
            })]).range([height_left - padding-padding_bottom, 0]);

        var y_scale_left_bottom = d3.scaleLinear()
            .domain([0, d3.max(covid_data, function (d) {
                return d.New_deaths;
            })]).range([height_left - padding-padding_bottom, 0]);

        var y_scale_right_top = d3.scaleLinear()
            .domain([0, d3.max(covid_data, function (d) {
                return d.Cases;
            })]).range([height_right - padding-padding_bottom, 0]);

        var y_scale_right_bottom = d3.scaleLinear()
            .domain([0, d3.max(covid_data, function (d) {
                return d.Deaths;
            })]).range([height_right - padding-padding_bottom, 0]);


        // scale for the average cases line chart
        // var y_scale_average_cases = d3.scaleLinear()
        //     .domain([0, d3.max(d, function (d) {
        //         return d.Seven_day_average_New_Cases;
        //     })]).range([height_left - padding, padding]);



        // y.domain([(0), d3.max(slices, function(New_Known_Cases) {
        // return d3.max(New_Known_Cases.values, function(d) {
        //     return d.measurement + 4; });
        // })
        //  ]);

        var svg_cases_top_left = d3.select("#new_cases")
            .append("g")
            .attr("transform", "translate("+padding+","+padding+")")

        // plot x axis
        svg_cases_top_left.append("g")
        .attr("transform", "translate(0, "+(height_left- padding-padding_bottom)+")")
        .call(d3.axisBottom(x_scale_left)).style("font-size","14px");
        // plot y axis
        svg_cases_top_left.append("g")
            // .attr("transform", "translate(0, "+height_left+")")
            .call(d3.axisLeft(y_scale_left_top)).style("font-size","14px");

    //    plot daily new cases bar chart
        svg_cases_top_left.selectAll("a")
        .data(case_phase1_data).enter().append("rect")
        .attr("x", function (d) {
            // if (d.date < case_phase1) {
                return x_scale_left(d.date);
            // }
        }).attr("y", function (d) {
            // if (d.date < case_phase1) {
                return y_scale_left_top(d.New_Known_Cases);
            // }
        }).attr("height", function (d) {
            // if (d.date < case_phase1) {
                return height_left - padding-padding_bottom - y_scale_left_top(d.New_Known_Cases);
            // }
        }).attr("width", "3")
        .attr("fill", "#14148a")
        .attr("class", "aa");

        svg_cases_top_left.selectAll("b")
            .data(case_phase2_data).enter().append("rect")
            .attr("x", function (d) {
                // if (d.date < case_phase1) {
                return x_scale_left(d.date);
                // }
            }).attr("y", function (d) {
            // if (d.date < case_phase1) {
            return y_scale_left_top(d.New_Known_Cases);
            // }
        }).attr("height", function (d) {
            // if (d.date < case_phase1) {
            return height_left - padding - padding_bottom - y_scale_left_top(d.New_Known_Cases);
            // }
        }).attr("width", "3")
            .attr("fill", "#14148a")
            .attr("class", "bb")
            .attr("opacity", "0");

        svg_cases_top_left.selectAll("c")
            .data(case_phase3_data).enter().append("rect")
            .attr("x", function (d) {
                // if (d.date < case_phase1) {
                return x_scale_left(d.date);
                // }
            }).attr("y", function (d) {
            // if (d.date < case_phase1) {
            return y_scale_left_top(d.New_Known_Cases);
            // }
        }).attr("height", function (d) {
            // if (d.date < case_phase1) {
            return height_left - padding-padding_bottom- y_scale_left_top(d.New_Known_Cases);
            // }
        }).attr("width", "3")
            .attr("fill", "#14148a")
            .attr("class", "cc")
            .attr("opacity", "0");

        svg_cases_top_left.selectAll("d")
            .data(case_phase4_data).enter().append("rect")
            .attr("x", function (d) {
                // if (d.date < case_phase1) {
                return x_scale_left(d.date);
                // }
            }).attr("y", function (d) {
            // if (d.date < case_phase1) {
            return y_scale_left_top(d.New_Known_Cases);
            // }
        }).attr("height", function (d) {
            // if (d.date < case_phase1) {
            return height_left - padding-padding_bottom - y_scale_left_top(d.New_Known_Cases);
            // }
        }).attr("width", "3")
            .attr("fill", "#14148a")
            .attr("class", "dd")
            .attr("opacity", "0");

    // plot 7 days average
    //     var avg_new_cases = []
    //     covid_data.forEach(function (entry) {
    //         avg_new_cases.push({date:entry.date, Seven_day_average_New_Cases:entry.Seven_day_average_New_Cases});
    //     })

        svg_cases_top_left.append("path")
        .datum(case_phase1_data)
            .attr("stroke", "orange")
            .attr("stroke-width", 2.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < case_phase1) {
                        return x_scale_left(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < case_phase1) {
                        return y_scale_left_top(d.Seven_day_average_New_Cases);
                    // }
                }))
        .attr("class", "aa")
            .attr("opacity", "1");

        svg_cases_top_left.append("path")
            .datum(case_phase2_data)
            .attr("stroke", "orange")
            .attr("stroke-width", 2.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < case_phase1) {
                    return x_scale_left(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < case_phase1) {
                    return y_scale_left_top(d.Seven_day_average_New_Cases);
                    // }
                }))
            .attr("class", "bb")
            .attr("opacity", "0");

        svg_cases_top_left.append("path")
            .datum(case_phase3_data)
            .attr("stroke", "orange")
            .attr("stroke-width", 2.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < case_phase1) {
                    return x_scale_left(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < case_phase1) {
                    return y_scale_left_top(d.Seven_day_average_New_Cases);
                    // }
                }))
            .attr("class", "cc")
            .attr("opacity", "0");

        svg_cases_top_left.append("path")
            .datum(case_phase4_data)
            .attr("stroke", "orange")
            .attr("stroke-width", 2.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < case_phase1) {
                    return x_scale_left(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < case_phase1) {
                    return y_scale_left_top(d.Seven_day_average_New_Cases);
                    // }
                }))
            .attr("class", "dd")
            .attr("opacity", "0");


    //    add label for y axis
        d3.select("#new_cases").append("g")
            .attr("transform", "translate(20,"+(height_left/2) + ")")
            .append("text")
            .attr("font-size", "18px")
            .attr("font-weight", "bold")
            .attr("fill", "black")
            .attr("font-family", "Calibri")
            .style("text-anchor", "middle")
            .attr("transform", "rotate(270)")
            .text("California daily cases")


    //    add title for top left chart
        d3.select("#new_cases").append("g").attr("class", "chart_title")
            .attr("transform", "translate("+(width_left/2-padding) + "," + padding*0.75 + ")")
        .append("text")
        .text(top_left_title)


    // plot line chart cumulative cases
        var svg_cases_top_right = svg_cases_top_left
            .append("g")
        .attr("transform", "translate(" + (width_total/2) + ",0)")
        // .append("g")
        //     .attr("transform", "translate("+padding+","+padding+")")
        svg_cases_top_right.append("g")
        .attr("transform", "translate(0, "+(height_right - padding-padding_bottom)+")")
            .call(d3.axisBottom(x_scale_right)).style("font-size","14px");
        svg_cases_top_right.append("g")
            .call(d3.axisLeft(y_scale_right_top)).style("font-size","14px");

        svg_cases_top_right.append("path")
            .datum(case_phase1_data)
            .attr("stroke", "#14148a")
            .attr("stroke-width", 3.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < case_phase1) {
                        return x_scale_right(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < case_phase1) {
                        return y_scale_right_top(d.Cases);
                    // }
                }))
            .attr("class", "aa")
            .attr("opacity", "1");

        svg_cases_top_right.append("path")
            .datum(case_phase2_data)
            .attr("stroke", "#14148a")
            .attr("stroke-width", 3.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < case_phase1) {
                    return x_scale_right(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < case_phase1) {
                    return y_scale_right_top(d.Cases);
                    // }
                }))
            .attr("class", "bb")
            .attr("opacity", "0");

        svg_cases_top_right.append("path")
            .datum(case_phase3_data)
            .attr("stroke", "#14148a")
            .attr("stroke-width", 3.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < case_phase1) {
                    return x_scale_right(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < case_phase1) {
                    return y_scale_right_top(d.Cases);
                    // }
                }))
            .attr("class", "cc")
            .attr("opacity", "0");

        svg_cases_top_right.append("path")
            .datum(case_phase4_data)
            .attr("stroke", "#14148a")
            .attr("stroke-width", 3.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < case_phase1) {
                    return x_scale_right(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < case_phase1) {
                    return y_scale_right_top(d.Cases);
                    // }
                }))
            .attr("class", "dd")
            .attr("opacity", "0");


        //    add label for y axis
        d3.select("#new_cases").append("g")
            .attr("transform", "translate(" + (10+width_total/2) + "," +(height_left/2) + ")")
            .append("text")
            .attr("font-size", "18px")
            .attr("font-weight", "bold")
            .attr("fill", "black")
            .attr("font-family", "Calibri")
            .style("text-anchor", "middle")
            .attr("transform", "rotate(270)")
            .text("California cumulative cases");


        //    add title for top right chart
        d3.select("#new_cases").append("g").attr("class", "chart_title")
            .attr("transform", "translate("+(width_total/2+width_right/2-padding) + "," + padding*0.75 + ")")
            .append("text")
            .text(top_right_title)


    //    plot the same chart for deaths count
        var svg_cases_bottom_left = d3.select("#new_deaths")
            .append("g")
            .attr("transform", "translate("+padding+","+padding+")")

        // plot x axis
        svg_cases_bottom_left.append("g")
            .attr("transform", "translate(0, "+(height_left - padding-padding_bottom)+")")
            .call(d3.axisBottom(x_scale_left)).style("font-size","14px");
        // plot y axis
        svg_cases_bottom_left.append("g")
            // .attr("transform", "translate(0, "+height_left+")")
            .call(d3.axisLeft(y_scale_left_bottom)).style("font-size","14px");

        //    plot daily new cases bar chart
        svg_cases_bottom_left.selectAll("a")
            .data(death_phase1_data).enter().append("rect")
            .attr("x", function (d) {
                // if (d.date < death_phase1) {
                    return x_scale_left(d.date);
                // }
            }).attr("y", function (d) {
            // if (d.date < death_phase1) {
                return y_scale_left_bottom(d.New_deaths);
            // }
        }).attr("height", function (d) {
            // if (d.date < death_phase1) {
                return height_left  - padding-padding_bottom - y_scale_left_bottom(d.New_deaths);
            // }
        }).attr("width", "3")
            .attr("fill", "black")
            .attr("class", "aa")
            .attr("opacity", "1");

        svg_cases_bottom_left.selectAll("b")
            .data(death_phase2_data).enter().append("rect")
            .attr("x", function (d) {
                // if (d.date < death_phase1) {
                return x_scale_left(d.date);
                // }
            }).attr("y", function (d) {
            // if (d.date < death_phase1) {
            return y_scale_left_bottom(d.New_deaths);
            // }
        }).attr("height", function (d) {
            // if (d.date < death_phase1) {
            return height_left - padding-padding_bottom - y_scale_left_bottom(d.New_deaths);
            // }
        }).attr("width", "3")
            .attr("fill", "black")
            .attr("class", "bb")
            .attr("opacity", "0");

        svg_cases_bottom_left.selectAll("c")
            .data(death_phase3_data).enter().append("rect")
            .attr("x", function (d) {
                // if (d.date < death_phase1) {
                return x_scale_left(d.date);
                // }
            }).attr("y", function (d) {
            // if (d.date < death_phase1) {
            return y_scale_left_bottom(d.New_deaths);
            // }
        }).attr("height", function (d) {
            // if (d.date < death_phase1) {
            return height_left - padding-padding_bottom - y_scale_left_bottom(d.New_deaths);
            // }
        }).attr("width", "3")
            .attr("fill", "black")
            .attr("class", "cc")
            .attr("opacity", "0");

        svg_cases_bottom_left.selectAll("d")
            .data(death_phase4_data).enter().append("rect")
            .attr("x", function (d) {
                // if (d.date < death_phase1) {
                return x_scale_left(d.date);
                // }
            }).attr("y", function (d) {
            // if (d.date < death_phase1) {
            return y_scale_left_bottom(d.New_deaths);
            // }
        }).attr("height", function (d) {
            // if (d.date < death_phase1) {
            return height_left - padding-padding_bottom - y_scale_left_bottom(d.New_deaths);
            // }
        }).attr("width", "3")
            .attr("fill", "black")
            .attr("class", "dd")
            .attr("opacity", "0");

        // plot 7 days average
        //     var avg_new_cases = []
        //     covid_data.forEach(function (entry) {
        //         avg_new_cases.push({date:entry.date, Seven_day_average_New_Cases:entry.Seven_day_average_New_Cases});
        //     })

        svg_cases_bottom_left.append("path")
            .datum(death_phase1_data)
            .attr("stroke", "red")
            .attr("stroke-width", 2.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < death_phase1) {
                        return x_scale_left(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < death_phase1) {
                        return y_scale_left_bottom(d.Seven_day_average_New_deaths);
                    // }
                }))
            .attr("class", "aa")
            .attr("opacity", "1");

        svg_cases_bottom_left.append("path")
            .datum(death_phase2_data)
            .attr("stroke", "red")
            .attr("stroke-width", 2.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < death_phase1) {
                    return x_scale_left(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < death_phase1) {
                    return y_scale_left_bottom(d.Seven_day_average_New_deaths);
                    // }
                }))
            .attr("class", "bb")
            .attr("opacity", "0");

        svg_cases_bottom_left.append("path")
            .datum(death_phase3_data)
            .attr("stroke", "red")
            .attr("stroke-width", 2.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < death_phase1) {
                    return x_scale_left(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < death_phase1) {
                    return y_scale_left_bottom(d.Seven_day_average_New_deaths);
                    // }
                }))
            .attr("class", "cc")
            .attr("opacity", "0");

        svg_cases_bottom_left.append("path")
            .datum(death_phase4_data)
            .attr("stroke", "red")
            .attr("stroke-width", 2.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < death_phase1) {
                    return x_scale_left(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < death_phase1) {
                    return y_scale_left_bottom(d.Seven_day_average_New_deaths);
                    // }
                }))
            .attr("class", "dd")
            .attr("opacity", "0");


        //    add label for y axis
        d3.select("#new_deaths").append("g")
            .attr("transform", "translate(20,"+(height_left/2) + ")")
            .append("text")
            .attr("font-size", "18px")
            .attr("font-weight", "bold")
            .attr("fill", "black")
            .attr("font-family", "Calibri")
            .style("text-anchor", "middle")
            .attr("transform", "rotate(270)")
            .text("California daily deaths")


        //    add title for bottom left chart
        d3.select("#new_deaths").append("g").attr("class", "chart_title")
            .attr("transform", "translate("+(width_left/2-padding) + "," + padding*0.75 + ")")
            .append("text")
            .text(bottom_left_title)

        // plot line chart cumulative deaths
        var svg_cases_bottom_right = svg_cases_bottom_left
            .append("g")
            .attr("transform", "translate(" + (width_total/2) + ",0)")
        // .append("g")
        //     .attr("transform", "translate("+padding+","+padding+")")
        svg_cases_bottom_right.append("g")
            .attr("transform", "translate(0, "+(height_right - padding-padding_bottom)+")")
            .call(d3.axisBottom(x_scale_right)).style("font-size","14px");
        svg_cases_bottom_right.append("g")
            .call(d3.axisLeft(y_scale_right_bottom)).style("font-size","14px");

        svg_cases_bottom_right.append("path")
            .datum(death_phase1_data)
            .attr("stroke", "black")
            .attr("stroke-width", 3.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < death_phase1) {
                        return x_scale_right(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < death_phase1) {
                        return y_scale_right_bottom(d.Deaths);
                    // }
                }))
            .attr("class", "aa")
            .attr("opacity", "1");

        svg_cases_bottom_right.append("path")
            .datum(death_phase2_data)
            .attr("stroke", "black")
            .attr("stroke-width", 3.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < death_phase1) {
                    return x_scale_right(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < death_phase1) {
                    return y_scale_right_bottom(d.Deaths);
                    // }
                }))
            .attr("class", "bb")
            .attr("opacity", "0");

        svg_cases_bottom_right.append("path")
            .datum(death_phase3_data)
            .attr("stroke", "black")
            .attr("stroke-width", 3.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < death_phase1) {
                    return x_scale_right(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < death_phase1) {
                    return y_scale_right_bottom(d.Deaths);
                    // }
                }))
            .attr("class", "cc")
            .attr("opacity", "0");

        svg_cases_bottom_right.append("path")
            .datum(death_phase4_data)
            .attr("stroke", "black")
            .attr("stroke-width", 3.5)
            .attr("fill", "none")
            .attr("d", d3.line()
                .x(function (d) {
                    // if (d.date < death_phase1) {
                    return x_scale_right(d.date);
                    // }
                })
                .y(function (d) {
                    // if (d.date < death_phase1) {
                    return y_scale_right_bottom(d.Deaths);
                    // }
                }))
            .attr("class", "dd")
            .attr("opacity", "0");

        //    add label for y axis
        d3.select("#new_deaths").append("g")
            .attr("transform", "translate(" + (10+width_total/2) + "," +(height_left/2) + ")")
            .append("text")
            .attr("font-size", "18px")
            .attr("font-weight", "bold")
            .attr("fill", "black")
            .attr("font-family", "Calibri")
            .style("text-anchor", "middle")
            .attr("transform", "rotate(270)")
            .text("California cumulative deaths")

        //    add title for bottom right chart
        d3.select("#new_deaths").append("g").attr("class", "chart_title")
            .attr("transform", "translate("+(width_total/2+width_right/2-padding) + "," + padding*0.75 + ")")
            .append("text")
            .text(bottom_right_title)





        // mouse over event for tooltip

        const tooltip_color = "green";
        var tooltip_parse = d3.timeFormat("%m/%d");
        svg_cases_top_left.selectAll("rect").on("mouseover", function (d) {
            var current_opacity = d3.select(this).attr("opacity");
            var current_x = parseFloat(d3.select(this).attr("x"));
            var current_y_1 = parseFloat(d3.select(this).attr("y")) - 60;
            var current_y_2 = parseFloat(d3.select(this).attr("y")) - 40;
            var current_y_3 = parseFloat(d3.select(this).attr("y")) - 20;
            if (current_opacity !== "0") {
                svg_cases_top_left.append("text").attr("class", "tooltip")
                    .attr("x", current_x).attr("y", current_y_1).attr("fill", tooltip_color).text(function () {
                    return "Date: "+tooltip_parse(d.date);
                });
                svg_cases_top_left.append("text").attr("class", "tooltip")
                    .attr("x", current_x).attr("y", current_y_2).attr("fill", tooltip_color).text(function () {
                    return "New Cases: "+d.New_Known_Cases;
                });
                svg_cases_top_left.append("text").attr("class", "tooltip")
                    .attr("x", current_x).attr("y", current_y_3).attr("fill", tooltip_color).text(function () {
                    return "7-day Average: "+d.New_deaths;
                });
            }
        }).on("mouseout", function (d) {
            d3.selectAll(".tooltip").remove();
        })

        svg_cases_bottom_left.selectAll("rect").on("mouseover", function (d) {
            var current_opacity = d3.select(this).attr("opacity");
            var current_x = parseFloat(d3.select(this).attr("x"));
            var current_y_1 = parseFloat(d3.select(this).attr("y")) - 60;
            var current_y_2 = parseFloat(d3.select(this).attr("y")) - 40;
            var current_y_3 = parseFloat(d3.select(this).attr("y")) - 20;
            if (current_opacity !== "0") {
                svg_cases_bottom_left.append("text").attr("class", "tooltip")
                    .attr("x", current_x).attr("y", current_y_1).attr("fill", tooltip_color).text(function () {
                    return "Date: "+tooltip_parse(d.date);
                });
                svg_cases_bottom_left.append("text").attr("class", "tooltip")
                    .attr("x", current_x).attr("y", current_y_2).attr("fill", tooltip_color).text(function () {
                    return "New Cases: "+d.New_deaths;
                });
                svg_cases_bottom_left.append("text").attr("class", "tooltip")
                    .attr("x", current_x).attr("y", current_y_3).attr("fill", tooltip_color).text(function () {
                    return "7-day Average: "+d.Deaths;
                });
            }
        }).on("mouseout", function (d) {
            d3.selectAll(".tooltip").remove();
        })

    }

    // add annotations
    var phase1_anno = d3.select("#new_cases_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+anno_padding_y+")")
        .append("text").attr("class", "chart_title").text(case_phase1_annotation)
        .attr("opacity", "1");
    var phase2_anno = d3.select("#new_cases_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+anno_padding_y+")")
        .append("text").attr("class", "chart_title").text(case_phase2_annotation)
        .attr("opacity", "0");
    var phase3_anno = d3.select("#new_cases_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+anno_padding_y+")")
        .append("text").attr("class", "chart_title").text(case_phase3_annotation)
        .attr("opacity", "0");
    var phase4_anno = d3.select("#new_cases_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+anno_padding_y+")")
        .append("text").attr("class", "chart_title").text(case_phase4_annotation)
        .attr("opacity", "0");
    var death1_anno = d3.select("#new_deaths_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+anno_padding_y+")")
        .append("text").attr("class", "chart_title").text(death_phase1_annotation)
        .attr("opacity", "1");
    var death2_anno = d3.select("#new_deaths_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+anno_padding_y+")")
        .append("text").attr("class", "chart_title").text(death_phase2_annotation)
        .attr("opacity", "0");
    var death3_anno = d3.select("#new_deaths_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+anno_padding_y+")")
        .append("text").attr("class", "chart_title").text(death_phase3_annotation)
        .attr("opacity", "0");
    var death4_anno = d3.select("#new_deaths_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+anno_padding_y+")")
        .append("text").attr("class", "chart_title").text(death_phase4_annotation)
        .attr("opacity", "0");

    var phase1_anno_2 = d3.select("#new_cases_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+(anno_padding_y+25)+")")
        .append("text").attr("class", "chart_title").text(case_phase1_annotation_2)
        .attr("opacity", "1");
    var phase2_anno_2 = d3.select("#new_cases_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+(anno_padding_y+25)+")")
        .append("text").attr("class", "chart_title").text(case_phase2_annotation_2)
        .attr("opacity", "0");
    var phase3_anno_2 = d3.select("#new_cases_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+(anno_padding_y+25)+")")
        .append("text").attr("class", "chart_title").text(case_phase3_annotation_2)
        .attr("opacity", "0");
    var phase4_anno_2 = d3.select("#new_cases_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+(anno_padding_y+25)+")")
        .append("text").attr("class", "chart_title").text(case_phase4_annotation_2)
        .attr("opacity", "0");
    var death1_anno_2 = d3.select("#new_deaths_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+(anno_padding_y+25)+")")
        .append("text").attr("class", "chart_title").text(death_phase1_annotation_2)
        .attr("opacity", "1");
    var death2_anno_2 = d3.select("#new_deaths_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+(anno_padding_y+25)+")")
        .append("text").attr("class", "chart_title").text(death_phase2_annotation_2)
        .attr("opacity", "0");
    var death3_anno_2 = d3.select("#new_deaths_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+(anno_padding_y+25)+")")
        .append("text").attr("class", "chart_title").text(death_phase3_annotation_2)
        .attr("opacity", "0");
    var death4_anno_2 = d3.select("#new_deaths_anno")
        .append("g").attr("transform", "translate("+anno_padding_x+","+(anno_padding_y+25)+")")
        .append("text").attr("class", "chart_title").text(death_phase4_annotation_2)
        .attr("opacity", "0");
    

    // add legend
    const legend_box_width_height = 15;
    var top_left_legend = d3.select("#new_cases")
    .append("g").attr("transform", "translate("+(width_left-padding+legend_padding_x) + "," + (padding+legend_padding_y) + ")")
    top_left_legend.append("rect").attr("class", "legend").attr("x", "0").attr("y","0").attr("width", legend_box_width_height).attr("height", legend_box_width_height)
    .attr("fill", "#14148a");
    top_left_legend.append("g").attr("transform", "translate(" + (legend_box_width_height + 5) + "," + (legend_box_width_height-3) + ")")
    .append("text").attr("class", "legend").text("Daily Cases");
    top_left_legend.append("g").attr("transform", "translate(0,"+(legend_box_width_height+5) + ")")
    .append("rect").attr("class", "legend").attr("x", "0").attr("y","0").attr("width", legend_box_width_height).attr("height", legend_box_width_height)
        .attr("fill", "orange");
    top_left_legend.append("g").attr("transform", "translate(" + (legend_box_width_height + 5) + "," + (legend_box_width_height-3+legend_box_width_height+5) + ")")
        .append("text").attr("class", "legend").text("7-Day Average");


    var top_right_legend = d3.select("#new_cases")
        .append("g").attr("transform", "translate("+(width_total/2+width_right-padding+legend_padding_x) + "," + (padding+legend_padding_y) + ")")
    top_right_legend.append("rect").attr("class", "legend").attr("x", "0").attr("y","0").attr("width", legend_box_width_height).attr("height", legend_box_width_height)
        .attr("fill", "#14148a");
    top_right_legend.append("g").attr("transform", "translate(" + (legend_box_width_height + 5) + "," + (legend_box_width_height-3) + ")")
        .append("text").attr("class", "legend").text("Daily Cum Cases");
    // top_right_legend.append("g").attr("transform", "translate(0,"+(legend_box_width_height+5) + ")")
    //     .append("rect").attr("class", "legend").attr("x", "0").attr("y","0").attr("width", legend_box_width_height).attr("height", legend_box_width_height)
    //     .attr("fill", "orange");
    // top_right_legend.append("g").attr("transform", "translate(" + (legend_box_width_height + 5) + "," + (legend_box_width_height-3+legend_box_width_height+5) + ")")
    //     .append("text").attr("class", "legend").text("7-Day Average");
    

    var bottom_left_legend = d3.select("#new_deaths")
        .append("g").attr("transform", "translate("+(width_left-padding+legend_padding_x) + "," + (padding+legend_padding_y) + ")")
    bottom_left_legend.append("rect").attr("class", "legend").attr("x", "0").attr("y","0").attr("width", legend_box_width_height).attr("height", legend_box_width_height)
        .attr("fill", "black");
    bottom_left_legend.append("g").attr("transform", "translate(" + (legend_box_width_height + 5) + "," + (legend_box_width_height-3) + ")")
        .append("text").attr("class", "legend").text("Daily Deaths");
    bottom_left_legend.append("g").attr("transform", "translate(0,"+(legend_box_width_height+5) + ")")
        .append("rect").attr("class", "legend").attr("x", "0").attr("y","0").attr("width", legend_box_width_height).attr("height", legend_box_width_height)
        .attr("fill", "red");
    bottom_left_legend.append("g").attr("transform", "translate(" + (legend_box_width_height + 5) + "," + (legend_box_width_height-3+legend_box_width_height+5) + ")")
        .append("text").attr("class", "legend").text("7-Day Average");

    var bottom_right_legend = d3.select("#new_deaths")
        .append("g").attr("transform", "translate("+(width_total/2+width_right-padding+legend_padding_x) + "," + (padding+legend_padding_y) + ")")
    bottom_right_legend.append("rect").attr("class", "legend").attr("x", "0").attr("y","0").attr("width", legend_box_width_height).attr("height", legend_box_width_height)
        .attr("fill", "black");
    bottom_right_legend.append("g").attr("transform", "translate(" + (legend_box_width_height + 5) + "," + (legend_box_width_height-3) + ")")
        .append("text").attr("class", "legend").text("Daily Cum Deaths");

    
    
    
    const transition_time = 1000;
    
    var move_slide = function(slide){
        // console.log("hello world");
        // change color on click
        if (slide === 1) {
            d3.select("#phase1").style("background-color", 'lightyellow');
            d3.select("#phase2").style("background-color", 'lightblue');
            d3.select("#phase3").style("background-color", 'lightblue');
            d3.select("#phase4").style("background-color", 'lightblue');
            d3.selectAll(".aa").transition().duration(transition_time).attr("opacity", "1");
            d3.selectAll(".bb").transition().duration(transition_time).attr("opacity", "0");
            d3.selectAll(".cc").transition().duration(transition_time).attr("opacity", "0");
            d3.selectAll(".dd").transition().duration(transition_time).attr("opacity", "0");
            phase1_anno.attr("opacity", "1");
            phase2_anno.attr("opacity", "0");
            phase3_anno.attr("opacity", "0");
            phase4_anno.attr("opacity", "0");
            death1_anno.attr("opacity", "1");
            death2_anno.attr("opacity", "0");
            death3_anno.attr("opacity", "0");
            death4_anno.attr("opacity", "0");
            phase1_anno_2.attr("opacity", "1");
            phase2_anno_2.attr("opacity", "0");
            phase3_anno_2.attr("opacity", "0");
            phase4_anno_2.attr("opacity", "0");
            death1_anno_2.attr("opacity", "1");
            death2_anno_2.attr("opacity", "0");
            death3_anno_2.attr("opacity", "0");
            death4_anno_2.attr("opacity", "0");
        } else if (slide === 2) {
            d3.select("#phase1").style("background-color", 'lightblue');
            d3.select("#phase2").style("background-color", 'lightyellow');
            d3.select("#phase3").style("background-color", 'lightblue');
            d3.select("#phase4").style("background-color", 'lightblue');
            d3.selectAll(".aa").transition().duration(transition_time).attr("opacity", "1");
            d3.selectAll(".bb").transition().duration(transition_time).attr("opacity", "1");
            d3.selectAll(".cc").transition().duration(transition_time).attr("opacity", "0");
            d3.selectAll(".dd").transition().duration(transition_time).attr("opacity", "0");
            phase1_anno.attr("opacity", "0");
            phase2_anno.attr("opacity", "1");
            phase3_anno.attr("opacity", "0");
            phase4_anno.attr("opacity", "0");
            death1_anno.attr("opacity", "0");
            death2_anno.attr("opacity", "1");
            death3_anno.attr("opacity", "0");
            death4_anno.attr("opacity", "0");
            phase1_anno_2.attr("opacity", "0");
            phase2_anno_2.attr("opacity", "1");
            phase3_anno_2.attr("opacity", "0");
            phase4_anno_2.attr("opacity", "0");
            death1_anno_2.attr("opacity", "0");
            death2_anno_2.attr("opacity", "1");
            death3_anno_2.attr("opacity", "0");
            death4_anno_2.attr("opacity", "0");
            // d3.select("#phaseA").attr("opacity", "0");
        } else if (slide === 3) {
            d3.select("#phase1").style("background-color", 'lightblue');
            d3.select("#phase2").style("background-color", 'lightblue');
            d3.select("#phase3").style("background-color", 'lightyellow');
            d3.select("#phase4").style("background-color", 'lightblue');
            d3.selectAll(".aa").transition().duration(transition_time).attr("opacity", "1");
            d3.selectAll(".bb").transition().duration(transition_time).attr("opacity", "1");
            d3.selectAll(".cc").transition().duration(transition_time).attr("opacity", "1");
            d3.selectAll(".dd").transition().duration(transition_time).attr("opacity", "0");
            phase1_anno.attr("opacity", "0");
            phase2_anno.attr("opacity", "0");
            phase3_anno.attr("opacity", "1");
            phase4_anno.attr("opacity", "0");
            death1_anno.attr("opacity", "0");
            death2_anno.attr("opacity", "0");
            death3_anno.attr("opacity", "1");
            death4_anno.attr("opacity", "0");
            phase1_anno_2.attr("opacity", "0");
            phase2_anno_2.attr("opacity", "0");
            phase3_anno_2.attr("opacity", "1");
            phase4_anno_2.attr("opacity", "0");
            death1_anno_2.attr("opacity", "0");
            death2_anno_2.attr("opacity", "0");
            death3_anno_2.attr("opacity", "1");
            death4_anno_2.attr("opacity", "0");
        } else if (slide === 4) {
            d3.select("#phase1").style("background-color", 'lightblue');
            d3.select("#phase2").style("background-color", 'lightblue');
            d3.select("#phase3").style("background-color", 'lightblue');
            d3.select("#phase4").style("background-color", 'lightyellow');
            d3.selectAll(".aa").transition().duration(transition_time).attr("opacity", "1");
            d3.selectAll(".bb").transition().duration(transition_time).attr("opacity", "1");
            d3.selectAll(".cc").transition().duration(transition_time).attr("opacity", "1");
            d3.selectAll(".dd").transition().duration(transition_time).attr("opacity", "1");
            phase1_anno.attr("opacity", "0");
            phase2_anno.attr("opacity", "0");
            phase3_anno.attr("opacity", "0");
            phase4_anno.attr("opacity", "1");
            death1_anno.attr("opacity", "0");
            death2_anno.attr("opacity", "0");
            death3_anno.attr("opacity", "0");
            death4_anno.attr("opacity", "1");
            phase1_anno_2.attr("opacity", "0");
            phase2_anno_2.attr("opacity", "0");
            phase3_anno_2.attr("opacity", "0");
            phase4_anno_2.attr("opacity", "1");
            death1_anno_2.attr("opacity", "0");
            death2_anno_2.attr("opacity", "0");
            death3_anno_2.attr("opacity", "0");
            death4_anno_2.attr("opacity", "1");
        }

    }
</script>
</body>
</html>
